{"code":"import MediaType from './utils/media-type';\r\nexport default class TapeMatcher {\r\n    constructor(tape, options) {\r\n        this.tape = tape;\r\n        this.options = options;\r\n    }\r\n    sameAs(otherTape) {\r\n        if (this.options.tapeMatcher) {\r\n            return this.options.tapeMatcher(this.tape, otherTape);\r\n        }\r\n        const otherReq = otherTape.request;\r\n        const req = this.tape.request;\r\n        const sameURL = req.url === otherReq.url;\r\n        if (!sameURL) {\r\n            this.options.logger.debug(`Not same URL ${req.url} vs ${otherReq.url}`);\r\n            return false;\r\n        }\r\n        const sameMethod = req.method === otherReq.method;\r\n        if (!sameMethod) {\r\n            this.options.logger.debug(`Not same METHOD ${req.method} vs ${otherReq.method}`);\r\n            return false;\r\n        }\r\n        const currentHeadersLength = Object.keys(req.headers).length;\r\n        const otherHeadersLength = Object.keys(otherReq.headers).length;\r\n        const sameNumberOfHeaders = currentHeadersLength === otherHeadersLength;\r\n        if (!sameNumberOfHeaders) {\r\n            this.options.logger.debug(`Not same #HEADERS ${JSON.stringify(req.headers)} vs ${JSON.stringify(otherReq.headers)}`);\r\n            return false;\r\n        }\r\n        let headersSame = true;\r\n        Object.keys(req.headers).forEach((k) => {\r\n            const entryHeader = req.headers[k];\r\n            const header = otherReq.headers[k];\r\n            headersSame = headersSame && entryHeader === header;\r\n        });\r\n        if (!headersSame) {\r\n            this.options.logger.debug(`Not same HEADERS values ${JSON.stringify(req.headers)} vs ${JSON.stringify(otherReq.headers)}`);\r\n            return false;\r\n        }\r\n        if (!req.body && !otherReq.body) {\r\n            return true;\r\n        }\r\n        if (!!req.body !== !!otherReq.body) {\r\n            return false;\r\n        }\r\n        if (!this.options.ignoreBody && req.body && otherReq.body) {\r\n            const mediaType = new MediaType(req);\r\n            let sameBody = false;\r\n            if (mediaType.isJSON() && req.body.length > 0 && otherReq.body.length > 0) {\r\n                sameBody =\r\n                    JSON.stringify(JSON.parse(req.body.toString())) ===\r\n                        JSON.stringify(JSON.parse(otherReq.body.toString()));\r\n            }\r\n            else {\r\n                sameBody = req.body.equals(otherReq.body);\r\n            }\r\n            if (!sameBody) {\r\n                this.options.logger.debug(`Not same BODY ${req.body} vs ${otherReq.body}`);\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n//# sourceMappingURL=tape-matcher.js.map","map":"{\"version\":3,\"file\":\"tape-matcher.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/tape-matcher.ts\"],\"names\":[],\"mappings\":\"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\"}"}
